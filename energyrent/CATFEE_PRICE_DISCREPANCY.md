# CatFee 价格差异说明

## 问题描述

网站上显示的价格（1.048 TRX）与后端 API 返回的价格（0 TRX）不一致。

## 原因分析

### 1. 预购账户模式 vs 直接支付模式

CatFee 支持两种支付模式：

**预购账户模式（API 模式）：**
- 需要在 CatFee 账户中预存 TRX 余额
- 使用 API 创建订单时，费用从账户余额扣除
- **估算 API 可能返回 `payment: 0`**（因为费用从账户扣除，不需要用户额外支付）
- 这是后端返回 0 的主要原因

**直接支付模式（网站模式）：**
- 用户直接支付 TRX 到 CatFee 提供的支付地址
- 网站显示的是实际需要支付的金额（1.048 TRX）
- 这是网站上显示的价格

### 2. API 响应字段可能不同

CatFee API 在不同模式下可能返回不同的字段：
- 预购模式：可能返回 `payment: 0` 或 `cost: 0`
- 直接支付模式：返回实际的 `payment` 或 `price` 字段

### 3. 价格计算

根据 CatFee 网站显示的实际价格：
- **65,000 Energy = 1.95 TRX（1小时）**
- 单价: 1.95 / 65000 ≈ 0.00003 TRX per Energy

**注意：** 价格可能不是完全线性的，不同数量可能有不同的单价。建议：
- 查看 CatFee 网站获取准确的实时价格
- 或者调用 CatFee API 获取实际报价

**估算计算：**
- 对于 65,000 Energy: 1.95 TRX
- 对于 131,000 Energy: 约 3.93 TRX（按比例估算）

## 解决方案

### 已实现的改进

1. **增强字段解析**
   - 尝试多个可能的字段名：`payment`, `total_cost`, `price`, `cost`, `amount`, `fee` 等
   - 支持嵌套对象（`data.payment`）

2. **详细日志输出**
   - 输出完整的 API 响应（`📊 CatFee API 原始响应`）
   - 显示从哪个字段提取到费用
   - 如果为 0，显示估算价格和计算过程

3. **智能估算**
   - 如果 API 返回 0，使用市场价格估算（0.000008 TRX/Energy）
   - 基于网站显示的价格进行计算

### 如何查看实际 API 响应

重启后端服务后，查看控制台日志：

```bash
# 应该能看到类似输出：
📊 CatFee API 原始响应: {
  "code": 0,
  "data": {
    "payment": "0",  // 或实际价格
    ...
  }
}
```

### 如何获取准确价格

**方法 1：查看后端日志**
- 重启后端服务
- 调用估算 API
- 查看日志中的 "📊 CatFee API 原始响应"
- 确认 API 实际返回的字段和值

**方法 2：使用网站价格**
- 如果 API 返回 0，系统会自动使用估算价格（1.048 TRX for 131K Energy）
- 这个价格基于网站显示的价格计算

**方法 3：切换到直接支付模式**
- 如果可能，配置 CatFee API 使用直接支付模式
- 这样 API 会返回实际的支付金额

## 价格对比

| 来源 | 费用 | 节省 | 说明 |
|------|------|------|------|
| CatFee 网站 | 1.048 TRX | ~12.052 TRX | 直接支付模式，实际价格 |
| 后端 API（预购模式） | 0 TRX | 13.1 TRX | 从账户余额扣除，不需要额外支付 |
| 后端估算（自动） | 1.048 TRX | ~12.052 TRX | 使用市场价格估算 |

## 建议

1. **查看后端日志**
   - 确认 API 实际返回的数据结构
   - 根据实际响应调整字段解析逻辑

2. **使用估算价格**
   - 如果 API 返回 0，系统会自动使用估算价格
   - 估算价格基于网站显示的价格（0.000008 TRX/Energy）

3. **考虑使用直接支付模式**
   - 如果希望显示实际价格，考虑切换到直接支付模式
   - 或者使用其他服务商（GasStation、TronXEnergy）

## 相关文档

- `CATFEE_PAYMENT_MODES.md` - CatFee 支付模式详细说明
- `TESTING.md` - 测试指南
- `CONFIGURATION.md` - 配置指南
